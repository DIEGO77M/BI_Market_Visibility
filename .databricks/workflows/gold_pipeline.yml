# =============================================================================
# GOLD LAYER PIPELINE - ORCHESTRATOR YAML
# =============================================================================
# Purpose: Run Gold Layer dimensions (Date, Product, PDV) sequentially
# Author: Diego Mayorga
# Date: 2026-01-07
# Compute: Serverless / Existing Cluster
# =============================================================================

resources:
  jobs:
    gold_layer_pipeline:
      name: "Gold Layer - Dimensional Model"
      description: |
        Gold Layer pipeline executing dimension notebooks sequentially:
        1. gold_dim_date
        2. gold_dim_product
        3. gold_dim_pdv
        
        Each notebook handles its own SCD2 logic (or static table) and validation.
      
      tags:
        project: "BI_Market_Visibility"
        layer: "gold"
        pattern: "orchestrator"
        owner: "diego.mayorgacapera@gmail.com"
      
      email_notifications:
        on_failure:
          - "diego.mayorgacapera@gmail.com"
        on_success:
          - "diego.mayorgacapera@gmail.com"
        no_alert_for_skipped_runs: true
      
      timeout_seconds: 10800  # 3h max for full run

      schedule:
        quartz_cron_expression: "0 0 6 * * ?"  # Daily 6 AM
        timezone_id: "America/Bogota"
        pause_status: "PAUSED"

      tasks:
        - task_key: "gold_dim_date"
          description: "Generate Gold Date dimension"
          notebook_task:
            notebook_path: "/Users/diego.mayorgacapera@gmail.com/.bundle/BI_Market_Visibility/dev/files/notebooks/gold/dimensions/gold_dim_date"
            source: "WORKSPACE"
          timeout_seconds: 3600

        - task_key: "gold_dim_product"
          description: "Generate Gold Product dimension (SCD Type 2)"
          depends_on:
            - task_key: "gold_dim_date"
          notebook_task:
            notebook_path: "/Users/diego.mayorgacapera@gmail.com/.bundle/BI_Market_Visibility/dev/files/notebooks/gold/dimensions/gold_dim_product"
            source: "WORKSPACE"
          timeout_seconds: 3600

        - task_key: "gold_dim_pdv"
          description: "Generate Gold PDV dimension (SCD Type 2)"
          depends_on:
            - task_key: "gold_dim_product"
          notebook_task:
            notebook_path: "/Users/diego.mayorgacapera@gmail.com/.bundle/BI_Market_Visibility/dev/files/notebooks/gold/dimensions/gold_dim_pdv"
            source: "WORKSPACE"
          timeout_seconds: 3600
